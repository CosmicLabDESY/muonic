<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>muonic.gui.widgets &mdash; muonic 2.1.0 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/pyramid.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '2.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="muonic 2.1.0 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" />
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Neuton&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Nobile:regular,italic,bold,bolditalic&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="../../../_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->

  </head>
  <body role="document">

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">muonic 2.1.0 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for muonic.gui.widgets</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Provides the different physics widgets</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">matplotlib.backends.backend_qt4agg</span> \
        <span class="kn">import</span> <span class="n">NavigationToolbar2QTAgg</span> <span class="k">as</span> <span class="n">NavigationToolbar</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">matplotlib.backends.backend_qt4agg</span> \
        <span class="kn">import</span> <span class="n">NavigationToolbar2QT</span> <span class="k">as</span> <span class="n">NavigationToolbar</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">PyQt4</span> <span class="kn">import</span> <span class="n">QtGui</span>
<span class="kn">from</span> <span class="nn">PyQt4</span> <span class="kn">import</span> <span class="n">QtCore</span>

<span class="kn">from</span> <span class="nn">muonic.daq.provider</span> <span class="kn">import</span> <span class="n">BaseDAQProvider</span>
<span class="kn">from</span> <span class="nn">muonic.gui.helpers</span> <span class="kn">import</span> <span class="n">HistoryAwareLineEdit</span>
<span class="kn">from</span> <span class="nn">muonic.gui.plot_canvases</span> <span class="kn">import</span> <span class="n">ScalarsCanvas</span><span class="p">,</span> <span class="n">LifetimeCanvas</span>
<span class="kn">from</span> <span class="nn">muonic.gui.plot_canvases</span> <span class="kn">import</span> <span class="n">PulseCanvas</span><span class="p">,</span> <span class="n">PulseWidthCanvas</span>
<span class="kn">from</span> <span class="nn">muonic.gui.plot_canvases</span> <span class="kn">import</span> <span class="n">VelocityCanvas</span>
<span class="kn">from</span> <span class="nn">muonic.gui.dialogs</span> <span class="kn">import</span> <span class="n">DecayConfigDialog</span><span class="p">,</span> <span class="n">PeriodicCallDialog</span>
<span class="kn">from</span> <span class="nn">muonic.gui.dialogs</span> <span class="kn">import</span> <span class="n">VelocityConfigDialog</span><span class="p">,</span> <span class="n">FitRangeConfigDialog</span>
<span class="kn">from</span> <span class="nn">muonic.analysis</span> <span class="kn">import</span> <span class="n">fit</span><span class="p">,</span> <span class="n">gaussian_fit</span>
<span class="kn">from</span> <span class="nn">muonic.analysis</span> <span class="kn">import</span> <span class="n">VelocityTrigger</span><span class="p">,</span> <span class="n">DecayTriggerThorough</span>
<span class="kn">from</span> <span class="nn">muonic.util</span> <span class="kn">import</span> <span class="n">rename_muonic_file</span><span class="p">,</span> <span class="n">get_hours_from_duration</span>
<span class="kn">from</span> <span class="nn">muonic.util</span> <span class="kn">import</span> <span class="n">get_setting</span><span class="p">,</span> <span class="n">WrappedFile</span>


<div class="viewcode-block" id="BaseWidget"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.BaseWidget">[docs]</a><span class="k">class</span> <span class="nc">BaseWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base widget class</span>

<span class="sd">    :param logger: logger object</span>
<span class="sd">    :type logger: logging.Logger</span>
<span class="sd">    :param parent: parent widget</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">QtGui</span><span class="o">.</span><span class="n">QWidget</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_active</span> <span class="o">=</span> <span class="bp">False</span>

<div class="viewcode-block" id="BaseWidget.update"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.BaseWidget.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update widget contents.</span>

<span class="sd">        :param args:</span>
<span class="sd">        :returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">QtGui</span><span class="o">.</span><span class="n">QWidget</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span></div>

<div class="viewcode-block" id="BaseWidget.calculate"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.BaseWidget.calculate">[docs]</a>    <span class="k">def</span> <span class="nf">calculate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates data related to this widget.</span>

<span class="sd">        :param args:</span>
<span class="sd">        :returns:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="BaseWidget.active"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.BaseWidget.active">[docs]</a>    <span class="k">def</span> <span class="nf">active</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Getter and setter for active state.</span>

<span class="sd">        :param value: value for the new state</span>
<span class="sd">        :type value: bool or None</span>
<span class="sd">        :returns: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_active</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active</span></div>

<div class="viewcode-block" id="BaseWidget.start"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.BaseWidget.start">[docs]</a>    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform setup here like resetting variables when the</span>
<span class="sd">        widget goes into active state</span>

<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="BaseWidget.stop"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.BaseWidget.stop">[docs]</a>    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform actions like saving data when the widget goes</span>
<span class="sd">        into inactive state</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="BaseWidget.daq_put"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.BaseWidget.daq_put">[docs]</a>    <span class="k">def</span> <span class="nf">daq_put</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send message to DAQ cards. Reuses the connection of the parent widget</span>
<span class="sd">        if present.</span>

<span class="sd">        Returns True if operation was successful.</span>

<span class="sd">        :param msg: message to send to the DAQ card</span>
<span class="sd">        :type msg: str</span>
<span class="sd">        :returns: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">daq</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;no daq handle found&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">daq</span><span class="p">,</span> <span class="n">BaseDAQProvider</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">daq</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="bp">False</span></div>

<div class="viewcode-block" id="BaseWidget.daq_get_last_msg"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.BaseWidget.daq_get_last_msg">[docs]</a>    <span class="k">def</span> <span class="nf">daq_get_last_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the last DAQ message received by the parent, if present.</span>

<span class="sd">        :returns: str or None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">last_daq_msg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">last_daq_msg</span>
        <span class="k">return</span> <span class="bp">None</span></div>

<div class="viewcode-block" id="BaseWidget.finish"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.BaseWidget.finish">[docs]</a>    <span class="k">def</span> <span class="nf">finish</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets called upon closing application. Implement cleanup routines like</span>
<span class="sd">        closing files here.</span>

<span class="sd">        :returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div></div>


<div class="viewcode-block" id="RateWidget"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.RateWidget">[docs]</a><span class="k">class</span> <span class="nc">RateWidget</span><span class="p">(</span><span class="n">BaseWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Widget for displaying a rate plot</span>

<span class="sd">    :param logger: logger object</span>
<span class="sd">    :type logger: logging.Logger</span>
<span class="sd">    :param filename: filename for the rate data file</span>
<span class="sd">    :type filename: str</span>
<span class="sd">    :param parent: parent widget</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">SCALAR_BUF_SIZE</span> <span class="o">=</span> <span class="mi">5</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">BaseWidget</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>

        <span class="c1"># measurement start and duration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurement_duration</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

        <span class="c1"># define the begin of the time interval for the rate calculation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_query_time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_window</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_trigger</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="c1"># lists of channel and trigger scalars</span>
        <span class="c1"># 0..3: channel 0-3</span>
        <span class="c1"># 4:    trigger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previous_scalars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_scalar_buffer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scalar_buffer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_scalar_buffer</span><span class="p">()</span>
        
        <span class="c1"># maximum and minimum seen rate across channels and trigger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_rate</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_rate</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># we will write the column headers of the data into</span>
        <span class="c1"># data_file in the first run</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">first_run</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="c1"># are we in first cycle after start button is pressed?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">first_cycle</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="c1"># data file options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_file</span> <span class="o">=</span> <span class="n">WrappedFile</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="c1"># rates store</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rates</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="c1"># initialize plot canvas</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scalars_monitor</span> <span class="o">=</span> <span class="n">ScalarsCanvas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">table</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QTableWidget</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">setColumnWidth</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">85</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">setColumnWidth</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">setHorizontalHeaderLabels</span><span class="p">([</span><span class="s2">&quot;rate [1/s]&quot;</span><span class="p">,</span> <span class="s2">&quot;counts&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">setVerticalHeaderLabels</span><span class="p">([</span><span class="s2">&quot;channel 0&quot;</span><span class="p">,</span> <span class="s2">&quot;channel 1&quot;</span><span class="p">,</span> 
                                            <span class="s2">&quot;channel 2&quot;</span><span class="p">,</span> <span class="s2">&quot;channel 3&quot;</span><span class="p">,</span> 
                                            <span class="s2">&quot;trigger&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">horizontalHeader</span><span class="p">()</span><span class="o">.</span><span class="n">setStretchLastSection</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

        <span class="c1"># table column fields</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rate_fields</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scalar_fields</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="c1"># add table widget items for channel and trigger values</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SCALAR_BUF_SIZE</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rate_fields</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">(</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rate_fields</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">setFlags</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsSelectable</span> <span class="o">|</span>
                                         <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsEnabled</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scalar_fields</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">(</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scalar_fields</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">setFlags</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsSelectable</span> <span class="o">|</span>
                                           <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsEnabled</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rate_fields</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scalar_fields</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="c1"># info fields</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info_fields</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="c1"># add widgets for info fields</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;start_date&quot;</span><span class="p">,</span> <span class="s2">&quot;daq_time&quot;</span><span class="p">,</span> <span class="s2">&quot;max_rate&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info_fields</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info_fields</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">setReadOnly</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info_fields</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">setDisabled</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

        <span class="c1"># initialize start and stop button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_button</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;Start run&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_button</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;Stop run&#39;</span><span class="p">)</span>

        <span class="n">QtCore</span><span class="o">.</span><span class="n">QObject</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_button</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s2">&quot;clicked()&quot;</span><span class="p">),</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>

        <span class="n">QtCore</span><span class="o">.</span><span class="n">QObject</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stop_button</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s2">&quot;clicked()&quot;</span><span class="p">),</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setup_layout</span><span class="p">()</span>

<div class="viewcode-block" id="RateWidget.new_scalar_buffer"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.RateWidget.new_scalar_buffer">[docs]</a>    <span class="k">def</span> <span class="nf">new_scalar_buffer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return new zeroed list of self.SCALAR_BUF_SIZE</span>

<span class="sd">        :returns: list of int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">SCALAR_BUF_SIZE</span></div>

<div class="viewcode-block" id="RateWidget.setup_layout"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.RateWidget.setup_layout">[docs]</a>    <span class="k">def</span> <span class="nf">setup_layout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets up all the layout parts of the widget</span>

<span class="sd">        :returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># create navigation toolbar</span>
        <span class="n">navigation_toolbar</span> <span class="o">=</span> <span class="n">NavigationToolbar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scalars_monitor</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

        <span class="n">layout</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QGridLayout</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># plot layout</span>
        <span class="n">plot_box</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QGroupBox</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">plot_layout</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QGridLayout</span><span class="p">(</span><span class="n">plot_box</span><span class="p">)</span>
        <span class="n">plot_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scalars_monitor</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># value table layout</span>
        <span class="n">value_box</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QGroupBox</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">value_box</span><span class="o">.</span><span class="n">setMaximumWidth</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
        <span class="n">value_layout</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QGridLayout</span><span class="p">(</span><span class="n">value_box</span><span class="p">)</span>
        <span class="n">value_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">value_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;started:&#39;</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">value_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info_fields</span><span class="p">[</span><span class="s1">&#39;start_date&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">value_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;daq time:&#39;</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">value_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info_fields</span><span class="p">[</span><span class="s1">&#39;daq_time&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">value_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;max rate:&#39;</span><span class="p">),</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">value_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info_fields</span><span class="p">[</span><span class="s1">&#39;max_rate&#39;</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># bottom line layout</span>
        <span class="n">bottom_line_box</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QGroupBox</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">bottom_line_layout</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QGridLayout</span><span class="p">(</span><span class="n">bottom_line_box</span><span class="p">)</span>
        <span class="n">bottom_line_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">navigation_toolbar</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">bottom_line_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_button</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">bottom_line_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stop_button</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

        <span class="c1"># put everything in place</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">value_box</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">plot_box</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">bottom_line_box</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span></div>

<div class="viewcode-block" id="RateWidget.query_daq_for_scalars"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.RateWidget.query_daq_for_scalars">[docs]</a>    <span class="k">def</span> <span class="nf">query_daq_for_scalars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send command to DAQ to query for scalars.</span>

<span class="sd">        :returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_query_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daq_put</span><span class="p">(</span><span class="s2">&quot;DS&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span></div>

<div class="viewcode-block" id="RateWidget.extract_scalars_from_message"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.RateWidget.extract_scalars_from_message">[docs]</a>    <span class="k">def</span> <span class="nf">extract_scalars_from_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extracts the scalar values for channel 0-3 and</span>
<span class="sd">        the trigger channel from daq message</span>

<span class="sd">        :param msg: DAQ message</span>
<span class="sd">        :type: str</span>
<span class="sd">        :return: list of ints</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">scalars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_scalar_buffer</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">msg</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SCALAR_BUF_SIZE</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;S</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="mi">11</span><span class="p">:</span>
                    <span class="n">scalars</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">3</span><span class="p">:],</span> <span class="mi">16</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">scalars</span></div>

<div class="viewcode-block" id="RateWidget.calculate"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.RateWidget.calculate">[docs]</a>    <span class="k">def</span> <span class="nf">calculate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the rates from the observed counts by dividing by the</span>
<span class="sd">        measurement interval.</span>

<span class="sd">        Returns True if last DAQ message was valid and could be processed.</span>

<span class="sd">        :returns: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">daq_get_last_msg</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">msg</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;DS&quot;</span><span class="p">)):</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="c1"># extract scalars from daq message</span>
        <span class="n">scalars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_scalars_from_message</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c1"># if this is the first time calculate is called, we want to set all</span>
        <span class="c1"># counters to zero. This is the beginning of the first bin.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_cycle</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Buffering muon counts for the first bin &quot;</span> <span class="o">+</span>
                              <span class="s2">&quot;of the rate plot.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">previous_scalars</span> <span class="o">=</span> <span class="n">scalars</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">first_cycle</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">return</span> <span class="bp">True</span>

        <span class="c1"># initialize temporary buffers for the scalar diffs</span>
        <span class="n">scalar_diffs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_scalar_buffer</span><span class="p">()</span>

        <span class="c1"># calculate differences and store current scalars for reuse</span>
        <span class="c1"># in the next cycle</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SCALAR_BUF_SIZE</span><span class="p">):</span>
            <span class="n">scalar_diffs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">scalars</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_scalars</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">previous_scalars</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">scalars</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="n">time_window</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_query_time</span>

        <span class="c1"># rates for scalars of channels and trigger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rates</span> <span class="o">=</span> <span class="p">[(</span><span class="n">_scalar</span> <span class="o">/</span> <span class="n">time_window</span><span class="p">)</span> <span class="k">for</span> <span class="n">_scalar</span> <span class="ow">in</span> <span class="n">scalar_diffs</span><span class="p">]</span>
        <span class="c1"># current time window</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rates</span> <span class="o">+=</span> <span class="p">[</span><span class="n">time_window</span><span class="p">]</span>
        <span class="c1"># scalars for channels and trigger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rates</span> <span class="o">+=</span> <span class="p">[</span><span class="n">_scalar</span> <span class="k">for</span> <span class="n">_scalar</span> <span class="ow">in</span> <span class="n">scalar_diffs</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">time_window</span> <span class="o">+=</span> <span class="n">time_window</span>

        <span class="c1"># add scalar diffs for channels and trigger to buffer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scalar_buffer</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="n">scalar_diffs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                              <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scalar_buffer</span><span class="p">)]</span>

        <span class="c1"># get minimum and maximum rate</span>
        <span class="n">min_rate</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
        <span class="n">max_rate</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>

        <span class="c1"># update minimum and maximum rate if needed</span>
        <span class="k">if</span> <span class="n">min_rate</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_rate</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">min_rate</span> <span class="o">=</span> <span class="n">min_rate</span>
        <span class="k">if</span> <span class="n">max_rate</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_rate</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_rate</span> <span class="o">=</span> <span class="n">max_rate</span>

        <span class="c1"># write the rates to data file. we have to catch IOErrors, can occur</span>
        <span class="c1"># if program is exited</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">active</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                        <span class="s2">&quot;</span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span>
                        <span class="p">(</span><span class="n">scalar_diffs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">scalar_diffs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                         <span class="n">scalar_diffs</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">scalar_diffs</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="p">[</span><span class="mi">5</span><span class="p">]))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Rate plot data was written to </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
                                  <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_file</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;ValueError, Rate plot data was not &quot;</span> <span class="o">+</span>
                                    <span class="s2">&quot;written to </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_file</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">True</span></div>

<div class="viewcode-block" id="RateWidget.update"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.RateWidget.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Display newly available data</span>

<span class="sd">        :returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">active</span><span class="p">():</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">query_daq_for_scalars</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_window</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_info_field</span><span class="p">(</span><span class="s2">&quot;daq_time&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2"> s&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_window</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_info_field</span><span class="p">(</span><span class="s2">&quot;max_rate&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2"> 1/s&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_rate</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_fields</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">get_setting</span><span class="p">(</span><span class="s2">&quot;active_ch</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_fields</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_trigger</span><span class="p">)</span>

        <span class="n">channel_config</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_setting</span><span class="p">(</span><span class="s2">&quot;active_ch</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">scalars_monitor</span><span class="o">.</span><span class="n">update_plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_trigger</span><span class="p">,</span>
                                         <span class="n">channel_config</span><span class="p">)</span></div>

<div class="viewcode-block" id="RateWidget.update_fields"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.RateWidget.update_fields">[docs]</a>    <span class="k">def</span> <span class="nf">update_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">disable_only</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update table fields for a channel, channel 4 is the trigger channel.</span>

<span class="sd">        :param channel: the channel index</span>
<span class="sd">        :type channel: int</span>
<span class="sd">        :param enabled: enable fields</span>
<span class="sd">        :type enabled: bool</span>
<span class="sd">        :param disable_only: do not set text if &#39;enabled&#39; is True</span>
<span class="sd">        :type disable_only: bool</span>
<span class="sd">        :returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">channel</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">SCALAR_BUF_SIZE</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">enabled</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">disable_only</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rate_fields</span><span class="p">[</span><span class="n">channel</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                        <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scalar_buffer</span><span class="p">[</span><span class="n">channel</span><span class="p">]</span> <span class="o">/</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">time_window</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scalar_fields</span><span class="p">[</span><span class="n">channel</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                        <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scalar_buffer</span><span class="p">[</span><span class="n">channel</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rate_fields</span><span class="p">[</span><span class="n">channel</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scalar_fields</span><span class="p">[</span><span class="n">channel</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="RateWidget.update_info_field"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.RateWidget.update_info_field">[docs]</a>    <span class="k">def</span> <span class="nf">update_info_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">enable</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set text of info field with &#39;key&#39; or</span>
<span class="sd">        trigger enable state if &#39;text&#39; is None</span>

<span class="sd">        :param key: the key of the info field</span>
<span class="sd">        :type key: str</span>
<span class="sd">        :param text: the text to set</span>
<span class="sd">        :type text: str</span>
<span class="sd">        :param enable: enable</span>
<span class="sd">        :type enable: bool</span>
<span class="sd">        :returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">text</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info_fields</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info_fields</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">setDisabled</span><span class="p">(</span><span class="ow">not</span> <span class="n">enable</span><span class="p">)</span></div>

<div class="viewcode-block" id="RateWidget.start"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.RateWidget.start">[docs]</a>    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Starts the rate measurement and opens the data file.</span>

<span class="sd">        :returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">active</span><span class="p">():</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Start Button Clicked&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">active</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">start_button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">first_cycle</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_window</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># reset scalar buffer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scalar_buffer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_scalar_buffer</span><span class="p">()</span>

        <span class="c1"># open file for writing and add comment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_file</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)</span>

        <span class="c1"># write column headers if this is the first run</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_run</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;chan0 | chan1 | chan2 | chan3 | &quot;</span> <span class="o">+</span>
                                 <span class="s2">&quot;R0 | R1 | R2 | R3 | &quot;</span> <span class="o">+</span>
                                 <span class="s2">&quot;trigger | Delta_time</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">first_run</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="c1"># determine type of measurement</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">is_widget_active</span><span class="p">(</span><span class="s2">&quot;decay&quot;</span><span class="p">):</span>
            <span class="n">measurement_type</span> <span class="o">=</span> <span class="s2">&quot;rate+decay&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">is_widget_active</span><span class="p">(</span><span class="s2">&quot;velocity&quot;</span><span class="p">):</span>
            <span class="n">measurement_type</span> <span class="o">=</span> <span class="s2">&quot;rate+velocity&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">measurement_type</span> <span class="o">=</span> <span class="s2">&quot;rate&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# new </span><span class="si">%s</span><span class="s2"> measurement run from: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span>
                             <span class="p">(</span><span class="n">measurement_type</span><span class="p">,</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">_%H-%M-%S&quot;</span><span class="p">)))</span>

        <span class="c1"># update table fields</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_fields</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">get_setting</span><span class="p">(</span><span class="s2">&quot;active_ch</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">),</span>
                               <span class="n">disable_only</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_fields</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_trigger</span><span class="p">,</span> <span class="n">disable_only</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="c1"># update info fields</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_info_field</span><span class="p">(</span><span class="s2">&quot;start_date&quot;</span><span class="p">,</span> <span class="n">enable</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_info_field</span><span class="p">(</span><span class="s2">&quot;daq_time&quot;</span><span class="p">,</span> <span class="n">enable</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_info_field</span><span class="p">(</span><span class="s2">&quot;max_rate&quot;</span><span class="p">,</span> <span class="n">enable</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_info_field</span><span class="p">(</span><span class="s2">&quot;start_date&quot;</span><span class="p">,</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">.%m.%Y %H:%M:%S&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_info_field</span><span class="p">(</span><span class="s2">&quot;daq_time&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_window</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_info_field</span><span class="p">(</span><span class="s2">&quot;max_rate&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_rate</span><span class="p">)</span>

        <span class="c1"># reset plot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scalars_monitor</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">show_pending</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="RateWidget.stop"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.RateWidget.stop">[docs]</a>    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stops the rate measurement and closes the data file.</span>

<span class="sd">        :returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">active</span><span class="p">():</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">active</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

        <span class="n">stop_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">measurement_duration</span> <span class="o">+=</span> <span class="n">stop_time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">start_button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_info_field</span><span class="p">(</span><span class="s2">&quot;start_date&quot;</span><span class="p">,</span> <span class="n">enable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_info_field</span><span class="p">(</span><span class="s2">&quot;daq_time&quot;</span><span class="p">,</span> <span class="n">enable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_info_field</span><span class="p">(</span><span class="s2">&quot;max_rate&quot;</span><span class="p">,</span> <span class="n">enable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# stopped run on: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span>
                             <span class="n">stop_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">_%H-%M-%S&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="RateWidget.finish"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.RateWidget.finish">[docs]</a>    <span class="k">def</span> <span class="nf">finish</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cleanup, close and rename data file</span>

<span class="sd">        :returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">active</span><span class="p">():</span>
            <span class="n">stop_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">measurement_duration</span> <span class="o">+=</span> <span class="n">stop_time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">data_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# stopped run on: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span>
                                 <span class="n">stop_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">_%H-%M-%S&quot;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># only rename if file actually exists</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_file</span><span class="o">.</span><span class="n">get_filename</span><span class="p">()):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">((</span><span class="s2">&quot;The rate measurement was active &quot;</span> <span class="o">+</span>
                                  <span class="s2">&quot;for </span><span class="si">%f</span><span class="s2"> hours&quot;</span><span class="p">)</span> <span class="o">%</span>
                                 <span class="n">get_hours_from_duration</span><span class="p">(</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">measurement_duration</span><span class="p">))</span>
                <span class="n">rename_muonic_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measurement_duration</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">data_file</span><span class="o">.</span><span class="n">get_filename</span><span class="p">())</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">IOError</span><span class="p">):</span>
                <span class="k">pass</span></div></div>


<div class="viewcode-block" id="PulseAnalyzerWidget"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.PulseAnalyzerWidget">[docs]</a><span class="k">class</span> <span class="nc">PulseAnalyzerWidget</span><span class="p">(</span><span class="n">BaseWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Provides a widget which is able to show a plot of triggered pulses.</span>

<span class="sd">    :param logger: logger object</span>
<span class="sd">    :type logger: logging.Logger</span>
<span class="sd">    :param pulse_extractor: pulse extractor object</span>
<span class="sd">    :type pulse_extractor: muonic.analysis.analyzer.PulseExtractor</span>
<span class="sd">    :param parent: parent widget</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">pulse_extractor</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">BaseWidget</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pulses</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pulse_widths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pulse_extractor</span> <span class="o">=</span> <span class="n">pulse_extractor</span>

        <span class="c1"># setup layout</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QGridLayout</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">checkbox</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QCheckBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkbox</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Show Oscilloscope and Pulse Width Distribution&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkbox</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;The oscilloscope will show the &quot;</span> <span class="o">+</span>
                                 <span class="s2">&quot;last triggered pulses in the &quot;</span> <span class="o">+</span>
                                 <span class="s2">&quot;selected time window&quot;</span><span class="p">)</span>
        <span class="n">QtCore</span><span class="o">.</span><span class="n">QObject</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">checkbox</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s2">&quot;clicked()&quot;</span><span class="p">),</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">on_checkbox_clicked</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pulse_canvas</span> <span class="o">=</span> <span class="n">PulseCanvas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pulse_width_canvas</span> <span class="o">=</span> <span class="n">PulseWidthCanvas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>

        <span class="n">pulse_toolbar</span> <span class="o">=</span> <span class="n">NavigationToolbar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pulse_canvas</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">pulse_width_toolbar</span> <span class="o">=</span> <span class="n">NavigationToolbar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pulse_width_canvas</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">checkbox</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pulse_canvas</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">pulse_toolbar</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pulse_width_canvas</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">pulse_width_toolbar</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<div class="viewcode-block" id="PulseAnalyzerWidget.calculate"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.PulseAnalyzerWidget.calculate">[docs]</a>    <span class="k">def</span> <span class="nf">calculate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pulses</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the pulse widths.</span>

<span class="sd">        :param pulses: extracted pulses</span>
<span class="sd">        :type pulses: list</span>
<span class="sd">        :returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">active</span><span class="p">():</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pulses</span> <span class="o">=</span> <span class="n">pulses</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pulses</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Not received any pulses&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="c1"># pulse_widths changed because falling edge can be None.</span>
        <span class="c1"># pulse_widths = [fe - le for chan in pulses[1:] for le,fe in chan]</span>

        <span class="n">pulse_widths</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pulses</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="k">for</span> <span class="n">le</span><span class="p">,</span> <span class="n">fe</span> <span class="ow">in</span> <span class="n">channel</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">fe</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">pulse_widths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fe</span> <span class="o">-</span> <span class="n">le</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pulse_widths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pulse_widths</span> <span class="o">+=</span> <span class="n">pulse_widths</span></div>
        
<div class="viewcode-block" id="PulseAnalyzerWidget.update"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.PulseAnalyzerWidget.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update plot canvases</span>

<span class="sd">        :returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">active</span><span class="p">():</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pulse_canvas</span><span class="o">.</span><span class="n">update_plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pulses</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pulse_width_canvas</span><span class="o">.</span><span class="n">update_plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pulse_widths</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pulse_widths</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="PulseAnalyzerWidget.on_checkbox_clicked"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.PulseAnalyzerWidget.on_checkbox_clicked">[docs]</a>    <span class="k">def</span> <span class="nf">on_checkbox_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Starts or stops the pulse analyzer depending on checkbox state</span>

<span class="sd">        :returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkbox</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span></div>

<div class="viewcode-block" id="PulseAnalyzerWidget.start"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.PulseAnalyzerWidget.start">[docs]</a>    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Starts the pulse analyzer</span>

<span class="sd">        :returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">active</span><span class="p">():</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;switching on pulse analyzer.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">active</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">daq_put</span><span class="p">(</span><span class="s2">&quot;CE&quot;</span><span class="p">)</span>

        <span class="c1"># extract pulses to file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pulse_extractor</span><span class="o">.</span><span class="n">write_pulses</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="PulseAnalyzerWidget.stop"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.PulseAnalyzerWidget.stop">[docs]</a>    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stops the pulse analyzer</span>

<span class="sd">        :returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">active</span><span class="p">():</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;switching off pulse analyzer.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">active</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

        <span class="c1"># stop extracting pulses to file if decay and velocity</span>
        <span class="c1"># measurements are inactive and global setting is also false</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">get_setting</span><span class="p">(</span><span class="s2">&quot;write_pulses&quot;</span><span class="p">)</span> <span class="ow">and</span>
                <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">is_widget_active</span><span class="p">(</span><span class="s2">&quot;decay&quot;</span><span class="p">)</span> <span class="ow">and</span>
                <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">is_widget_active</span><span class="p">(</span><span class="s2">&quot;velocity&quot;</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pulse_extractor</span><span class="o">.</span><span class="n">write_pulses</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="StatusWidget"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.StatusWidget">[docs]</a><span class="k">class</span> <span class="nc">StatusWidget</span><span class="p">(</span><span class="n">BaseWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Provide a widget which shows the status information</span>
<span class="sd">    of the DAQ and the software.</span>

<span class="sd">    :param logger: logger object</span>
<span class="sd">    :type logger: logging.Logger</span>
<span class="sd">    :param parent: parent widget</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">TEXT_UNSET</span> <span class="o">=</span> <span class="s2">&quot;not set yet - click on Refresh.&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">BaseWidget</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>

        <span class="c1"># setup stats</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daq_stats</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daq_stats</span><span class="p">[</span><span class="s1">&#39;thresholds&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daq_stats</span><span class="p">[</span><span class="s1">&#39;active_channels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muonic_stats</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="c1"># setup daq stats</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daq_stats</span><span class="p">[</span><span class="s1">&#39;thresholds&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TEXT_UNSET</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daq_stats</span><span class="p">[</span><span class="s1">&#39;active_channels&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">daq_stats</span><span class="p">[</span><span class="s1">&#39;coincidences&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TEXT_UNSET</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daq_stats</span><span class="p">[</span><span class="s1">&#39;coincidence_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TEXT_UNSET</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daq_stats</span><span class="p">[</span><span class="s1">&#39;veto&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TEXT_UNSET</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daq_stats</span><span class="p">[</span><span class="s1">&#39;decay_veto&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;not set yet - start Muon &quot;</span> <span class="o">+</span>
                                        <span class="s2">&quot;Decay Measurement.&quot;</span><span class="p">)</span>

        <span class="c1"># setup muonic stats</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muonic_stats</span><span class="p">[</span><span class="s1">&#39;measurements&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TEXT_UNSET</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muonic_stats</span><span class="p">[</span><span class="s1">&#39;refresh_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TEXT_UNSET</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muonic_stats</span><span class="p">[</span><span class="s1">&#39;open_files&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TEXT_UNSET</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muonic_stats</span><span class="p">[</span><span class="s1">&#39;start_params&#39;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
                       <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">opts</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>

        <span class="c1"># setup widgets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daq_widgets</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daq_widgets</span><span class="p">[</span><span class="s1">&#39;thresholds&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daq_widgets</span><span class="p">[</span><span class="s1">&#39;active_channels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muonic_widgets</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="c1"># setup daq widgets</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daq_widgets</span><span class="p">[</span><span class="s1">&#39;thresholds&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daq_widgets</span><span class="p">[</span><span class="s1">&#39;thresholds&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">setReadOnly</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daq_widgets</span><span class="p">[</span><span class="s1">&#39;thresholds&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">daq_stats</span><span class="p">[</span><span class="s1">&#39;thresholds&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daq_widgets</span><span class="p">[</span><span class="s1">&#39;thresholds&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">setDisabled</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">daq_widgets</span><span class="p">[</span><span class="s1">&#39;active_channels&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daq_widgets</span><span class="p">[</span><span class="s1">&#39;active_channels&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Channel </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daq_widgets</span><span class="p">[</span><span class="s1">&#39;active_channels&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">setReadOnly</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daq_widgets</span><span class="p">[</span><span class="s1">&#39;active_channels&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;coincidences&#39;</span><span class="p">,</span> <span class="s1">&#39;coincidence_time&#39;</span><span class="p">,</span> <span class="s1">&#39;veto&#39;</span><span class="p">,</span> <span class="s1">&#39;decay_veto&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daq_widgets</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daq_widgets</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">setReadOnly</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daq_widgets</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">setDisabled</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daq_widgets</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">daq_stats</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

        <span class="c1"># setup muonic widgets</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;open_files&#39;</span><span class="p">,</span> <span class="s1">&#39;start_params&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">muonic_widgets</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPlainTextEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">muonic_widgets</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">setReadOnly</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">muonic_widgets</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">setDisabled</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">muonic_widgets</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">setPlainText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">muonic_stats</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;measurements&#39;</span><span class="p">,</span> <span class="s1">&#39;refresh_time&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">muonic_widgets</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">muonic_widgets</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">setReadOnly</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">muonic_widgets</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">setDisabled</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">muonic_widgets</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">muonic_stats</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

        <span class="n">layout</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QGridLayout</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># add daq status widgets</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Status of the DAQ card:&quot;</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Active channels:&quot;</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Threshold:&quot;</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Trigger condition:&quot;</span><span class="p">),</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Time window for trigger condition:&quot;</span><span class="p">),</span>
                         <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Veto:&quot;</span><span class="p">),</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Muon Decay Veto:&quot;</span><span class="p">),</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">daq_widgets</span><span class="p">[</span><span class="s1">&#39;active_channels&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">daq_widgets</span><span class="p">[</span><span class="s1">&#39;thresholds&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">daq_widgets</span><span class="p">[</span><span class="s1">&#39;coincidences&#39;</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">daq_widgets</span><span class="p">[</span><span class="s1">&#39;coincidence_time&#39;</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">daq_widgets</span><span class="p">[</span><span class="s1">&#39;veto&#39;</span><span class="p">],</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">daq_widgets</span><span class="p">[</span><span class="s1">&#39;decay_veto&#39;</span><span class="p">],</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

        <span class="c1"># add muonic status widgets</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Status of Muonic:&quot;</span><span class="p">),</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Active measurements:&quot;</span><span class="p">),</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Measurement intervals:&quot;</span><span class="p">),</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Start parameter:&quot;</span><span class="p">),</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Currently opened files:&quot;</span><span class="p">),</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">muonic_widgets</span><span class="p">[</span><span class="s1">&#39;measurements&#39;</span><span class="p">],</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">muonic_widgets</span><span class="p">[</span><span class="s1">&#39;refresh_time&#39;</span><span class="p">],</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">muonic_widgets</span><span class="p">[</span><span class="s1">&#39;start_params&#39;</span><span class="p">],</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">muonic_widgets</span><span class="p">[</span><span class="s1">&#39;open_files&#39;</span><span class="p">],</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_button</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Refresh&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_button</span><span class="o">.</span><span class="n">setDisabled</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">QtCore</span><span class="o">.</span><span class="n">QObject</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">refresh_button</span><span class="p">,</span>
                               <span class="n">QtCore</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s2">&quot;clicked()&quot;</span><span class="p">),</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">on_refresh_clicked</span><span class="p">)</span>

        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">refresh_button</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>

<div class="viewcode-block" id="StatusWidget.on_refresh_clicked"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.StatusWidget.on_refresh_clicked">[docs]</a>    <span class="k">def</span> <span class="nf">on_refresh_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Refresh the status information</span>

<span class="sd">        :returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_button</span><span class="o">.</span><span class="n">setDisabled</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Refreshing status information.&quot;</span><span class="p">)</span>

        <span class="c1"># request status information from DAQ card</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daq_put</span><span class="p">(</span><span class="s1">&#39;TL&#39;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daq_put</span><span class="p">(</span><span class="s1">&#39;DC&#39;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">active</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">process_incoming</span><span class="p">()</span></div>

<div class="viewcode-block" id="StatusWidget._update_daq_stats"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.StatusWidget._update_daq_stats">[docs]</a>    <span class="k">def</span> <span class="nf">_update_daq_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gather daq status information.</span>

<span class="sd">        :returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daq_stats</span><span class="p">[</span><span class="s1">&#39;active_channels&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">get_setting</span><span class="p">(</span><span class="s2">&quot;active_ch</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daq_stats</span><span class="p">[</span><span class="s1">&#39;thresholds&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> \
                <span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> mV&quot;</span> <span class="o">%</span> <span class="n">get_setting</span><span class="p">(</span><span class="s2">&quot;threshold_ch</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">get_setting</span><span class="p">(</span><span class="s2">&quot;veto&quot;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">get_setting</span><span class="p">(</span><span class="s2">&quot;veto_ch</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">daq_stats</span><span class="p">[</span><span class="s1">&#39;veto&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;veto with channel </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daq_stats</span><span class="p">[</span><span class="s1">&#39;veto&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;no veto set&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">is_widget_active</span><span class="p">(</span><span class="s2">&quot;decay&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daq_stats</span><span class="p">[</span><span class="s1">&#39;decay_veto&#39;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="s2">&quot;software veto with channel </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">get_widget</span><span class="p">(</span><span class="s2">&quot;decay&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">veto_pulse_channel</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daq_stats</span><span class="p">[</span><span class="s1">&#39;decay_veto&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;not set yet - start Muon &quot;</span> <span class="o">+</span>
                                            <span class="s2">&quot;Decay Measurement.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">daq_stats</span><span class="p">[</span><span class="s1">&#39;coincidence_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> ns&quot;</span> <span class="o">%</span>
                                              <span class="n">get_setting</span><span class="p">(</span><span class="s2">&quot;gate_width&quot;</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s2">&quot;Single&quot;</span><span class="p">,</span> <span class="s2">&quot;Twofold&quot;</span><span class="p">,</span> <span class="s2">&quot;Threefold&quot;</span><span class="p">,</span>
                                   <span class="s2">&quot;Fourfold&quot;</span><span class="p">]):</span>
            <span class="k">if</span> <span class="n">get_setting</span><span class="p">(</span><span class="s2">&quot;coincidence</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">daq_stats</span><span class="p">[</span><span class="s1">&#39;coincidences&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> Coincidence&quot;</span> <span class="o">%</span> <span class="n">value</span></div>

<div class="viewcode-block" id="StatusWidget._update_muonic_stats"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.StatusWidget._update_muonic_stats">[docs]</a>    <span class="k">def</span> <span class="nf">_update_muonic_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gather muonic status information.</span>

<span class="sd">        :returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">measurements</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">title</span> <span class="ow">in</span> <span class="p">[(</span><span class="s2">&quot;rate&quot;</span><span class="p">,</span> <span class="s2">&quot;Muon Rates&quot;</span><span class="p">),</span>
                            <span class="p">(</span><span class="s2">&quot;decay&quot;</span><span class="p">,</span> <span class="s2">&quot;Muon Decay&quot;</span><span class="p">),</span>
                            <span class="p">(</span><span class="s2">&quot;velocity&quot;</span><span class="p">,</span> <span class="s2">&quot;Muon Velocity&quot;</span><span class="p">),</span>
                            <span class="p">(</span><span class="s2">&quot;pulse&quot;</span><span class="p">,</span> <span class="s2">&quot;Pulse Analyzer&quot;</span><span class="p">)]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">is_widget_active</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
                <span class="n">measurements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">muonic_stats</span><span class="p">[</span><span class="s1">&#39;measurements&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">measurements</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muonic_stats</span><span class="p">[</span><span class="s1">&#39;refresh_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">%f</span><span class="s2"> s&quot;</span> <span class="o">%</span>
                                             <span class="n">get_setting</span><span class="p">(</span><span class="s2">&quot;time_window&quot;</span><span class="p">))</span>

        <span class="c1"># since we use WrappedFile for opening file, we can</span>
        <span class="c1"># easily track the open files</span>
        <span class="n">open_files</span> <span class="o">=</span> <span class="n">WrappedFile</span><span class="o">.</span><span class="n">get_open_files</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">muonic_stats</span><span class="p">[</span><span class="s1">&#39;open_files&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">open_files</span><span class="p">)</span></div>

<div class="viewcode-block" id="StatusWidget.update"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.StatusWidget.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fill the status information in the widget.</span>

<span class="sd">        :returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">active</span><span class="p">()</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isVisible</span><span class="p">():</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Refreshing status infos&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_update_daq_stats</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_muonic_stats</span><span class="p">()</span>

        <span class="c1"># update daq widgets</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daq_widgets</span><span class="p">[</span><span class="s1">&#39;thresholds&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">daq_stats</span><span class="p">[</span><span class="s1">&#39;thresholds&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daq_widgets</span><span class="p">[</span><span class="s1">&#39;thresholds&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">setDisabled</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daq_widgets</span><span class="p">[</span><span class="s1">&#39;thresholds&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">daq_widgets</span><span class="p">[</span><span class="s1">&#39;active_channels&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">daq_stats</span><span class="p">[</span><span class="s1">&#39;active_channels&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;coincidences&#39;</span><span class="p">,</span> <span class="s1">&#39;coincidence_time&#39;</span><span class="p">,</span> <span class="s1">&#39;veto&#39;</span><span class="p">,</span> <span class="s1">&#39;decay_veto&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daq_widgets</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">daq_stats</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daq_widgets</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

        <span class="c1"># update muonic widgets</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;measurements&#39;</span><span class="p">,</span> <span class="s1">&#39;refresh_time&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">muonic_widgets</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">muonic_stats</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">muonic_widgets</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;start_params&#39;</span><span class="p">,</span> <span class="s1">&#39;open_files&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">muonic_widgets</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">setPlainText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">muonic_stats</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">muonic_widgets</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_button</span><span class="o">.</span><span class="n">setDisabled</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">active</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="VelocityWidget"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.VelocityWidget">[docs]</a><span class="k">class</span> <span class="nc">VelocityWidget</span><span class="p">(</span><span class="n">BaseWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Shows the muon velocity plot</span>

<span class="sd">    :param logger: logger object</span>
<span class="sd">    :type logger: logging.Logger</span>
<span class="sd">    :param pulse_extractor: pulse extractor object</span>
<span class="sd">    :type pulse_extractor: muonic.analysis.analyzer.PulseExtractor</span>
<span class="sd">    :param parent: parent widget</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">pulse_extractor</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">BaseWidget</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pulse_extractor</span> <span class="o">=</span> <span class="n">pulse_extractor</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">upper_channel</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lower_channel</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muon_counter</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">binning</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>

        <span class="c1"># default fit range</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_range</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binning</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">binning</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">event_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_event_time</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">active_since</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="c1"># velocity canvas</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_canvas</span> <span class="o">=</span> <span class="n">VelocityCanvas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span>
                                          <span class="n">binning</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">binning</span><span class="p">)</span>

        <span class="c1"># we want the plot canvas to fill as much space as possible</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_canvas</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span>
                <span class="n">QtGui</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">,</span>
                <span class="n">QtGui</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">)</span>

        <span class="c1"># velocity trigger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span> <span class="o">=</span> <span class="n">VelocityTrigger</span><span class="p">(</span><span class="n">logger</span><span class="p">)</span>

        <span class="c1"># checkbox and buttons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkbox</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QCheckBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkbox</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Measure Flight Time&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fit_button</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;Fit!&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fit_range_button</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;Fit Range&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_range_button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

        <span class="n">QtCore</span><span class="o">.</span><span class="n">QObject</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">checkbox</span><span class="p">,</span>
                               <span class="n">QtCore</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s2">&quot;clicked()&quot;</span><span class="p">),</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">on_checkbox_clicked</span><span class="p">)</span>
        <span class="n">QtCore</span><span class="o">.</span><span class="n">QObject</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_button</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s2">&quot;clicked()&quot;</span><span class="p">),</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">on_fit_clicked</span><span class="p">)</span>
        <span class="n">QtCore</span><span class="o">.</span><span class="n">QObject</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_range_button</span><span class="p">,</span>
                               <span class="n">QtCore</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s2">&quot;clicked()&quot;</span><span class="p">),</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">on_fit_range_clicked</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">running_status</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muon_counter_label</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_event_label</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">active_since_label</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">navigation_toolbar</span> <span class="o">=</span> <span class="n">NavigationToolbar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_canvas</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

        <span class="c1"># add widgets to layout</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QGridLayout</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">checkbox</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">muon_counter_label</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_event_label</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">active_since_label</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_canvas</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">navigation_toolbar</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_range_button</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_button</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<div class="viewcode-block" id="VelocityWidget.on_fit_clicked"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.VelocityWidget.on_fit_clicked">[docs]</a>    <span class="k">def</span> <span class="nf">on_fit_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fit the muon velocity histogram</span>

<span class="sd">        :returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Using fit range of </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_range</span><span class="p">))</span>
        <span class="n">fit_results</span> <span class="o">=</span> <span class="n">gaussian_fit</span><span class="p">(</span>
                <span class="n">bincontent</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_canvas</span><span class="o">.</span><span class="n">heights</span><span class="p">),</span>
                <span class="n">binning</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">binning</span><span class="p">,</span> <span class="n">fitrange</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_range</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fit_results</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_canvas</span><span class="o">.</span><span class="n">show_fit</span><span class="p">(</span><span class="o">*</span><span class="n">fit_results</span><span class="p">)</span></div>

<div class="viewcode-block" id="VelocityWidget.on_fit_range_clicked"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.VelocityWidget.on_fit_range_clicked">[docs]</a>    <span class="k">def</span> <span class="nf">on_fit_range_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adjust the fit range</span>

<span class="sd">        :returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dialog</span> <span class="o">=</span> <span class="n">FitRangeConfigDialog</span><span class="p">(</span>
                <span class="n">upper_lim</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">60.</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                <span class="n">lower_lim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">60.</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">dimension</span><span class="o">=</span><span class="s1">&#39;ns&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">dialog</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">upper_limit</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">get_widget_value</span><span class="p">(</span><span class="s2">&quot;upper_limit&quot;</span><span class="p">)</span>
            <span class="n">lower_limit</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">get_widget_value</span><span class="p">(</span><span class="s2">&quot;lower_limit&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fit_range</span> <span class="o">=</span> <span class="p">(</span><span class="n">lower_limit</span><span class="p">,</span> <span class="n">upper_limit</span><span class="p">)</span></div>

<div class="viewcode-block" id="VelocityWidget.on_checkbox_clicked"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.VelocityWidget.on_checkbox_clicked">[docs]</a>    <span class="k">def</span> <span class="nf">on_checkbox_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Starts or stops detecting muons depending on checkbox state</span>

<span class="sd">        :returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkbox</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span></div>

<div class="viewcode-block" id="VelocityWidget.calculate"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.VelocityWidget.calculate">[docs]</a>    <span class="k">def</span> <span class="nf">calculate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pulses</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Trigger muon flight</span>

<span class="sd">        :param pulses: extracted pulses</span>
<span class="sd">        :type pulses: list</span>
<span class="sd">        :returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pulses</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">flight_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span><span class="o">.</span><span class="n">trigger</span><span class="p">(</span><span class="n">pulses</span><span class="p">,</span>
                                           <span class="n">upper_channel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">upper_channel</span><span class="p">,</span>
                                           <span class="n">lower_channel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lower_channel</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">flight_time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">flight_time</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;measured flight time </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">flight_time</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">event_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">flight_time</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">muon_counter</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_event_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span></div>

<div class="viewcode-block" id="VelocityWidget.update"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.VelocityWidget.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update widget</span>

<span class="sd">        :returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">active</span><span class="p">()</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_data</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fit_range_button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_canvas</span><span class="o">.</span><span class="n">update_plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">event_data</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">muon_counter_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;We have detected </span><span class="si">%d</span><span class="s2"> muons &quot;</span> <span class="o">%</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">muon_counter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_event_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                <span class="s2">&quot;The last muon was detected at </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">last_event_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">event_data</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="VelocityWidget.start"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.VelocityWidget.start">[docs]</a>    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Start detecting muons</span>

<span class="sd">        :returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">active</span><span class="p">():</span>
            <span class="k">return</span>

        <span class="c1"># launch the settings dialog</span>
        <span class="n">dialog</span> <span class="o">=</span> <span class="n">VelocityConfigDialog</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">dialog</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">checkbox</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">muon_counter_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;We have detected </span><span class="si">%d</span><span class="s2"> muons &quot;</span> <span class="o">%</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">muon_counter</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_since</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_since_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                    <span class="s2">&quot;The measurement is active since </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">active_since</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">chan</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">dialog</span><span class="o">.</span><span class="n">get_widget_value</span><span class="p">(</span><span class="s2">&quot;upper_checkbox_</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">chan</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">upper_channel</span> <span class="o">=</span> <span class="n">chan</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># chan index is shifted</span>
                <span class="k">if</span> <span class="n">dialog</span><span class="o">.</span><span class="n">get_widget_value</span><span class="p">(</span><span class="s2">&quot;lower_checkbox_</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">chan</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lower_channel</span> <span class="o">=</span> <span class="n">chan</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># chan index is shifted</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Switching off decay measurement if running!&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">is_widget_active</span><span class="p">(</span><span class="s2">&quot;decay&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">get_widget</span><span class="p">(</span><span class="s2">&quot;decay&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">running_status</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Muon velocity &quot;</span> <span class="o">+</span>
                                               <span class="s2">&quot;measurement active!&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">status_bar</span><span class="o">.</span><span class="n">addPermanentWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">running_status</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">active</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

            <span class="c1"># restart rate measurement</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">get_widget</span><span class="p">(</span><span class="s2">&quot;rate&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">get_widget</span><span class="p">(</span><span class="s2">&quot;rate&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

            <span class="c1"># enable counter</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daq_put</span><span class="p">(</span><span class="s2">&quot;CE&quot;</span><span class="p">)</span>

            <span class="c1"># write pulses to file</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pulse_extractor</span><span class="o">.</span><span class="n">write_pulses</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Moun velocity config canceled&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">checkbox</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_since_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="VelocityWidget.stop"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.VelocityWidget.stop">[docs]</a>    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stop detecting muons</span>

<span class="sd">        :returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">active</span><span class="p">():</span>
            <span class="k">return</span>

        <span class="c1"># stop extracting pulses to file if pulse analyzer and decay</span>
        <span class="c1"># measurements are inactive and global setting is also false</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">get_setting</span><span class="p">(</span><span class="s2">&quot;write_pulses&quot;</span><span class="p">)</span> <span class="ow">and</span>
                <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">is_widget_active</span><span class="p">(</span><span class="s2">&quot;pulse&quot;</span><span class="p">)</span> <span class="ow">and</span>
                <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">is_widget_active</span><span class="p">(</span><span class="s2">&quot;decay&quot;</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pulse_extractor</span><span class="o">.</span><span class="n">write_pulses</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">active</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkbox</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">active_since_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">status_bar</span><span class="o">.</span><span class="n">removeWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">running_status</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">get_widget</span><span class="p">(</span><span class="s2">&quot;rate&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="DecayWidget"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.DecayWidget">[docs]</a><span class="k">class</span> <span class="nc">DecayWidget</span><span class="p">(</span><span class="n">BaseWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Shows the muon decay plot</span>

<span class="sd">    :param logger: logger object</span>
<span class="sd">    :type logger: logging.Logger</span>
<span class="sd">    :param filename: filename for the rate data file</span>
<span class="sd">    :type filename: str</span>
<span class="sd">    :param pulse_extractor: pulse extractor object</span>
<span class="sd">    :type pulse_extractor: muonic.analysis.analyzer.PulseExtractor</span>
<span class="sd">    :param parent: parent widget</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">pulse_extractor</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">BaseWidget</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pulse_extractor</span> <span class="o">=</span> <span class="n">pulse_extractor</span>

        <span class="c1"># default decay configuration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_single_pulse_width</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_single_pulse_width</span> <span class="o">=</span> <span class="mi">100000</span>  <span class="c1"># inf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_double_pulse_width</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_double_pulse_width</span> <span class="o">=</span> <span class="mi">100000</span>  <span class="c1"># inf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muon_counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">single_pulse_channel</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">double_pulse_channel</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">veto_pulse_channel</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decay_min_time</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># ignore first bin because of after pulses,</span>
        <span class="c1"># see https://github.com/achim1/muonic/issues/39</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">binning</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">21</span><span class="p">)</span>

        <span class="c1"># default fit range</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_range</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">10.</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">event_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_event_time</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">active_since</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mu_file</span> <span class="o">=</span> <span class="n">WrappedFile</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="c1"># measurement duration and start time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurement_duration</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">previous_coinc_time_03</span> <span class="o">=</span> <span class="s2">&quot;00&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previous_coinc_time_02</span> <span class="o">=</span> <span class="s2">&quot;0A&quot;</span>

        <span class="c1"># lifetime plot canvas</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_canvas</span> <span class="o">=</span> <span class="n">LifetimeCanvas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>

        <span class="c1"># we want the plot canvas to fill as much space as possible</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_canvas</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span>
                <span class="n">QtGui</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">,</span>
                <span class="n">QtGui</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">)</span>

        <span class="c1"># decay trigger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span> <span class="o">=</span> <span class="n">DecayTriggerThorough</span><span class="p">(</span><span class="n">logger</span><span class="p">)</span>

        <span class="c1"># checkbox and buttons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkbox</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QCheckBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkbox</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Check for Decayed Muons&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fit_button</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Fit!&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fit_range_button</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Fit Range&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_range_button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

        <span class="n">QtCore</span><span class="o">.</span><span class="n">QObject</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">checkbox</span><span class="p">,</span>
                               <span class="n">QtCore</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s2">&quot;clicked()&quot;</span><span class="p">),</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">on_checkbox_clicked</span><span class="p">)</span>
        <span class="n">QtCore</span><span class="o">.</span><span class="n">QObject</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_button</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s2">&quot;clicked()&quot;</span><span class="p">),</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">on_fit_clicked</span><span class="p">)</span>
        <span class="n">QtCore</span><span class="o">.</span><span class="n">QObject</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_range_button</span><span class="p">,</span>
                               <span class="n">QtCore</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s2">&quot;clicked()&quot;</span><span class="p">),</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">on_fit_range_clicked</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">running_status</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muon_counter_label</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_event_label</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">active_since_label</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">navigation_toolbar</span> <span class="o">=</span> <span class="n">NavigationToolbar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_canvas</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

        <span class="c1"># add widgets to layout</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QGridLayout</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">checkbox</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">muon_counter_label</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_event_label</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">active_since_label</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_canvas</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">navigation_toolbar</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_range_button</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_button</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<div class="viewcode-block" id="DecayWidget.set_previous_coincidence_times"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.DecayWidget.set_previous_coincidence_times">[docs]</a>    <span class="k">def</span> <span class="nf">set_previous_coincidence_times</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_03</span><span class="p">,</span> <span class="n">time_02</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the previous coincidence times obtained from the DAQ card</span>

<span class="sd">        :param time_03: time 03</span>
<span class="sd">        :type time_03: str</span>
<span class="sd">        :param time_02: time 03</span>
<span class="sd">        :type time_02: str</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previous_coinc_time_03</span> <span class="o">=</span> <span class="n">time_03</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previous_coinc_time_02</span> <span class="o">=</span> <span class="n">time_02</span></div>

<div class="viewcode-block" id="DecayWidget.on_fit_clicked"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.DecayWidget.on_fit_clicked">[docs]</a>    <span class="k">def</span> <span class="nf">on_fit_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fit the muon decay histogram</span>

<span class="sd">        :returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fit_results</span> <span class="o">=</span> <span class="n">fit</span><span class="p">(</span><span class="n">bincontent</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_canvas</span><span class="o">.</span><span class="n">heights</span><span class="p">),</span>
                          <span class="n">binning</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">binning</span><span class="p">,</span> <span class="n">fitrange</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_range</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fit_results</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_canvas</span><span class="o">.</span><span class="n">show_fit</span><span class="p">(</span><span class="o">*</span><span class="n">fit_results</span><span class="p">)</span></div>

<div class="viewcode-block" id="DecayWidget.on_fit_range_clicked"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.DecayWidget.on_fit_range_clicked">[docs]</a>    <span class="k">def</span> <span class="nf">on_fit_range_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adjust the fit range</span>

<span class="sd">        :returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dialog</span> <span class="o">=</span> <span class="n">FitRangeConfigDialog</span><span class="p">(</span>
                <span class="n">upper_lim</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                <span class="n">lower_lim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                <span class="n">dimension</span><span class="o">=</span><span class="s1">&#39;microsecond&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">dialog</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">upper_limit</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">get_widget_value</span><span class="p">(</span><span class="s2">&quot;upper_limit&quot;</span><span class="p">)</span>
            <span class="n">lower_limit</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">get_widget_value</span><span class="p">(</span><span class="s2">&quot;lower_limit&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fit_range</span> <span class="o">=</span> <span class="p">(</span><span class="n">lower_limit</span><span class="p">,</span> <span class="n">upper_limit</span><span class="p">)</span></div>

<div class="viewcode-block" id="DecayWidget.on_checkbox_clicked"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.DecayWidget.on_checkbox_clicked">[docs]</a>    <span class="k">def</span> <span class="nf">on_checkbox_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Starts or stops the muon decay check depending on checkbox state</span>

<span class="sd">        :returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkbox</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span></div>

<div class="viewcode-block" id="DecayWidget.calculate"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.DecayWidget.calculate">[docs]</a>    <span class="k">def</span> <span class="nf">calculate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pulses</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Trigger muon decay</span>

<span class="sd">        :param pulses: extracted pulses</span>
<span class="sd">        :type pulses: list</span>
<span class="sd">        :returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">decay</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span><span class="o">.</span><span class="n">trigger</span><span class="p">(</span>
                <span class="n">pulses</span><span class="p">,</span> <span class="n">single_channel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">single_pulse_channel</span><span class="p">,</span>
                <span class="n">double_channel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">double_pulse_channel</span><span class="p">,</span>
                <span class="n">veto_channel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">veto_pulse_channel</span><span class="p">,</span>
                <span class="n">min_decay_time</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">decay_min_time</span><span class="p">,</span>
                <span class="n">min_single_pulse_width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">min_single_pulse_width</span><span class="p">,</span>
                <span class="n">max_single_pulse_width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_single_pulse_width</span><span class="p">,</span>
                <span class="n">min_double_pulse_width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">min_double_pulse_width</span><span class="p">,</span>
                <span class="n">max_double_pulse_width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_double_pulse_width</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">decay</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">when</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">asctime</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">event_data</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">decay</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">when</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">muon_counter</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_event_time</span> <span class="o">=</span> <span class="n">when</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;We have found a decaying muon with a &quot;</span> <span class="o">+</span>
                             <span class="s2">&quot;decay time of </span><span class="si">%f</span><span class="s2"> at </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">decay</span><span class="p">,</span> <span class="n">when</span><span class="p">))</span></div>

<div class="viewcode-block" id="DecayWidget.update"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.DecayWidget.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update widget</span>

<span class="sd">        :returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">active</span><span class="p">()</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_data</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">decay_times</span> <span class="o">=</span> <span class="p">[</span><span class="n">decay_time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">decay_time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_data</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fit_button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_range_button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_canvas</span><span class="o">.</span><span class="n">update_plot</span><span class="p">(</span><span class="n">decay_times</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">muon_counter_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;We have </span><span class="si">%d</span><span class="s2"> decayed muons &quot;</span> <span class="o">%</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">muon_counter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_event_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                <span class="s2">&quot;Last detected decay at time </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">last_event_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">decay</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_data</span><span class="p">:</span>
            <span class="n">decay_time</span> <span class="o">=</span> <span class="n">decay</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mu_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Decay </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">decay_time</span><span class="p">),</span>
                                                  <span class="nb">repr</span><span class="p">(</span><span class="n">decay</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">event_data</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="DecayWidget.start"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.DecayWidget.start">[docs]</a>    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Start check for muon decay</span>

<span class="sd">        :returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">active</span><span class="p">():</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">checkbox</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

        <span class="c1"># launch the settings dialog</span>
        <span class="n">dialog</span> <span class="o">=</span> <span class="n">DecayConfigDialog</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">dialog</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">checkbox</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">muon_counter_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;We have </span><span class="si">%d</span><span class="s2"> decayed muons &quot;</span> <span class="o">%</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">muon_counter</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_since</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_since_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                    <span class="s2">&quot;The measurement is active since </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">active_since</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">decay_min_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                    <span class="n">dialog</span><span class="o">.</span><span class="n">get_widget_value</span><span class="p">(</span><span class="s2">&quot;min_pulse_time&quot;</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">dialog</span><span class="o">.</span><span class="n">get_widget_value</span><span class="p">(</span><span class="s2">&quot;set_pulse_width_conditions&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">min_single_pulse_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                        <span class="n">dialog</span><span class="o">.</span><span class="n">get_widget_value</span><span class="p">(</span><span class="s2">&quot;min_single_pulse_width&quot;</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">max_single_pulse_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                        <span class="n">dialog</span><span class="o">.</span><span class="n">get_widget_value</span><span class="p">(</span><span class="s2">&quot;max_single_pulse_width&quot;</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">min_double_pulse_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                        <span class="n">dialog</span><span class="o">.</span><span class="n">get_widget_value</span><span class="p">(</span><span class="s2">&quot;min_double_pulse_width&quot;</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">max_double_pulse_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                        <span class="n">dialog</span><span class="o">.</span><span class="n">get_widget_value</span><span class="p">(</span><span class="s2">&quot;max_double_pulse_width&quot;</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">chan</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">dialog</span><span class="o">.</span><span class="n">get_widget_value</span><span class="p">(</span><span class="s2">&quot;single_checkbox_</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">chan</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">single_pulse_channel</span> <span class="o">=</span> <span class="n">chan</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># ch index is shifted</span>
                <span class="k">if</span> <span class="n">dialog</span><span class="o">.</span><span class="n">get_widget_value</span><span class="p">(</span><span class="s2">&quot;double_checkbox_</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">chan</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">double_pulse_channel</span> <span class="o">=</span> <span class="n">chan</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># ch index is shifted</span>
                <span class="k">if</span> <span class="n">dialog</span><span class="o">.</span><span class="n">get_widget_value</span><span class="p">(</span><span class="s2">&quot;veto_checkbox_</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">chan</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">veto_pulse_channel</span> <span class="o">=</span> <span class="n">chan</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># ch index is shifted</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Switching off velocity measurement if running!&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">is_widget_active</span><span class="p">(</span><span class="s2">&quot;decay&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">get_widget</span><span class="p">(</span><span class="s2">&quot;velocity&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;We now activate the muon decay mode!</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span>
                             <span class="s2">&quot;All other Coincidence/Veto settings will &quot;</span> <span class="o">+</span>
                             <span class="s2">&quot;be overridden!&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Changing gate width and enabeling pulses&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Looking for single pulse in Channel </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span>
                             <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">single_pulse_channel</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Looking for double pulse in Channel </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span>
                             <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">double_pulse_channel</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Using veto pulses in Channel </span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span>
                             <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">veto_pulse_channel</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">running_status</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Muon Decay &quot;</span> <span class="o">+</span>
                                               <span class="s2">&quot;measurement active!&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">status_bar</span><span class="o">.</span><span class="n">addPermanentWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">running_status</span><span class="p">)</span>

            <span class="c1"># configure DAQ card with coincidence/veto settings</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daq_put</span><span class="p">(</span><span class="s2">&quot;DC&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daq_put</span><span class="p">(</span><span class="s2">&quot;CE&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daq_put</span><span class="p">(</span><span class="s2">&quot;WC 03 04&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daq_put</span><span class="p">(</span><span class="s2">&quot;WC 02 0A&quot;</span><span class="p">)</span>

            <span class="c1"># this should set the veto to none (because we have a</span>
            <span class="c1"># software veto) and the coincidence to single,</span>
            <span class="c1"># so we take all pulses</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daq_put</span><span class="p">(</span><span class="s2">&quot;WC 00 0F&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mu_file</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mu_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# new decay measurement run from: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">_%H-%M-%S&quot;</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">active</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

            <span class="c1"># restart rate measurement</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">get_widget</span><span class="p">(</span><span class="s2">&quot;rate&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">get_widget</span><span class="p">(</span><span class="s2">&quot;rate&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

            <span class="c1"># write pulses to file</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pulse_extractor</span><span class="o">.</span><span class="n">write_pulses</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Moun decay config canceled&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">checkbox</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_since_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="DecayWidget.stop"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.DecayWidget.stop">[docs]</a>    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stop check for muon decay</span>

<span class="sd">        :returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">active</span><span class="p">():</span>
            <span class="k">return</span>

        <span class="n">stop_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurement_duration</span> <span class="o">+=</span> <span class="n">stop_time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span>

        <span class="c1"># reset coincidence times</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daq_put</span><span class="p">(</span><span class="s2">&quot;WC 03 &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_coinc_time_03</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daq_put</span><span class="p">(</span><span class="s2">&quot;WC 02 &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_coinc_time_02</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Muon decay mode now deactivated, returning to &quot;</span> <span class="o">+</span>
                         <span class="s2">&quot;previous setting (if available)&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mu_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# stopped run on: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span>
                           <span class="n">stop_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">_%H-%M-%S&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mu_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># stop extracting pulses to file if pulse analyzer and velocity</span>
        <span class="c1"># measurements are inactive and global setting is also false</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">get_setting</span><span class="p">(</span><span class="s2">&quot;write_pulses&quot;</span><span class="p">)</span> <span class="ow">and</span>
                <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">is_widget_active</span><span class="p">(</span><span class="s2">&quot;pulse&quot;</span><span class="p">)</span> <span class="ow">and</span>
                <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">is_widget_active</span><span class="p">(</span><span class="s2">&quot;velocity&quot;</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pulse_extractor</span><span class="o">.</span><span class="n">write_pulses</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">active</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkbox</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">active_since_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">status_bar</span><span class="o">.</span><span class="n">removeWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">running_status</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">get_widget</span><span class="p">(</span><span class="s2">&quot;rate&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span></div>

<div class="viewcode-block" id="DecayWidget.finish"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.DecayWidget.finish">[docs]</a>    <span class="k">def</span> <span class="nf">finish</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cleanup, close and rename decay file</span>

<span class="sd">        :returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu_file</span><span class="o">.</span><span class="n">closed</span><span class="p">:</span>
            <span class="n">stop_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

            <span class="c1"># add duration</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">measurement_duration</span> <span class="o">+=</span> <span class="n">stop_time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">mu_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# stopped run on: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span>
                               <span class="n">stop_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">_%H-%M-%S&quot;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mu_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># only rename if file actually exists</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mu_file</span><span class="o">.</span><span class="n">get_filename</span><span class="p">()):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">((</span><span class="s2">&quot;The muon decay measurement was &quot;</span> <span class="o">+</span>
                                  <span class="s2">&quot;active for </span><span class="si">%f</span><span class="s2"> hours&quot;</span><span class="p">)</span> <span class="o">%</span>
                                 <span class="n">get_hours_from_duration</span><span class="p">(</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">measurement_duration</span><span class="p">))</span>
                <span class="n">rename_muonic_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measurement_duration</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">mu_file</span><span class="o">.</span><span class="n">get_filename</span><span class="p">())</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">IOError</span><span class="p">):</span>
                <span class="k">pass</span></div></div>


<div class="viewcode-block" id="DAQWidget"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.DAQWidget">[docs]</a><span class="k">class</span> <span class="nc">DAQWidget</span><span class="p">(</span><span class="n">BaseWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Shows the DAQ message log. The message log can be written to a file.</span>
<span class="sd">    This widget has a command line to issue DAQ commands, as well as</span>
<span class="sd">    periodic commands within a user defined interval.</span>

<span class="sd">    :param logger: logger object</span>
<span class="sd">    :type logger: logging.Logger</span>
<span class="sd">    :param filename: filename for the rate data file</span>
<span class="sd">    :type filename: str</span>
<span class="sd">    :param parent: parent widget</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">BaseWidget</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>

        <span class="c1"># raw output file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_file</span> <span class="o">=</span> <span class="n">WrappedFile</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_raw_file</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_status</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="c1"># measurement start and duration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurement_duration</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

        <span class="c1"># periodic call</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">command</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">periodic_commands</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">periodic_status</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">periodic_call_timer</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QTimer</span><span class="p">()</span>

        <span class="c1"># daq msg log</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daq_msg_log</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPlainTextEdit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daq_msg_log</span><span class="o">.</span><span class="n">setReadOnly</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daq_msg_log</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QFont</span><span class="p">(</span><span class="s2">&quot;monospace&quot;</span><span class="p">))</span>
        <span class="c1"># 500 lines history</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daq_msg_log</span><span class="o">.</span><span class="n">document</span><span class="p">()</span><span class="o">.</span><span class="n">setMaximumBlockCount</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>

        <span class="c1"># input field and buttons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Command&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hello_edit</span> <span class="o">=</span> <span class="n">HistoryAwareLineEdit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_button</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Save RAW-File&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">periodic_button</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Periodic Call&quot;</span><span class="p">)</span>

        <span class="c1"># connect signals</span>
        <span class="n">QtCore</span><span class="o">.</span><span class="n">QObject</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">periodic_call_timer</span><span class="p">,</span>
                               <span class="n">QtCore</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s2">&quot;timeout()&quot;</span><span class="p">),</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">_execute_commands</span><span class="p">)</span>
        <span class="n">QtCore</span><span class="o">.</span><span class="n">QObject</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hello_edit</span><span class="p">,</span>
                               <span class="n">QtCore</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s2">&quot;returnPressed()&quot;</span><span class="p">),</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">on_hello_clicked</span><span class="p">)</span>
        <span class="n">QtCore</span><span class="o">.</span><span class="n">QObject</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_button</span><span class="p">,</span>
                               <span class="n">QtCore</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s2">&quot;clicked()&quot;</span><span class="p">),</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">on_file_clicked</span><span class="p">)</span>
        <span class="n">QtCore</span><span class="o">.</span><span class="n">QObject</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">periodic_button</span><span class="p">,</span>
                               <span class="n">QtCore</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s2">&quot;clicked()&quot;</span><span class="p">),</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">on_periodic_clicked</span><span class="p">)</span>

        <span class="c1"># add widgets to layout</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QGridLayout</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">daq_msg_log</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hello_edit</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_button</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">periodic_button</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

<div class="viewcode-block" id="DAQWidget.on_hello_clicked"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.DAQWidget.on_hello_clicked">[docs]</a>    <span class="k">def</span> <span class="nf">on_hello_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send a message to the DAQ card</span>

<span class="sd">        :returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hello_edit</span><span class="o">.</span><span class="n">displayText</span><span class="p">())</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daq_put</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hello_edit</span><span class="o">.</span><span class="n">add_hist_item</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hello_edit</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span></div>

<div class="viewcode-block" id="DAQWidget.on_file_clicked"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.DAQWidget.on_file_clicked">[docs]</a>    <span class="k">def</span> <span class="nf">on_file_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the raw DAQ data to a automatically named file</span>

<span class="sd">        :returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_file</span><span class="o">.</span><span class="n">closed</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">file_button</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Stop saving RAW-File&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">daq_put</span><span class="p">(</span><span class="s2">&quot;CE&quot;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">output_file</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                        <span class="s2">&quot;# raw data run from: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">_%H-%M-%S&quot;</span><span class="p">))</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">write_status</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Writing to </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
                                                 <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_file</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">status_bar</span><span class="o">.</span><span class="n">addPermanentWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_status</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;unable to open file &#39;</span><span class="si">%s</span><span class="s2">&#39;: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
                                  <span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_file</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file_button</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Save RAW-File&quot;</span><span class="p">)</span>

            <span class="n">stop_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
            <span class="c1"># add duration</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">measurement_duration</span> <span class="o">+=</span> <span class="n">stop_time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# stopped run on: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span>
                                   <span class="n">stop_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">_%H-%M-%S&quot;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">status_bar</span><span class="o">.</span><span class="n">removeWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_status</span><span class="p">)</span></div>

<div class="viewcode-block" id="DAQWidget.on_periodic_clicked"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.DAQWidget.on_periodic_clicked">[docs]</a>    <span class="k">def</span> <span class="nf">on_periodic_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Issue a DAQ command periodically</span>

<span class="sd">        :returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dialog</span> <span class="o">=</span> <span class="n">PeriodicCallDialog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">command</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">dialog</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">get_widget_value</span><span class="p">(</span><span class="s2">&quot;interval&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">command</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">dialog</span><span class="o">.</span><span class="n">get_widget_value</span><span class="p">(</span><span class="s2">&quot;command&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

            <span class="c1"># ignore empty commands</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">command</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="k">return</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">periodic_commands</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">command</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">)</span>

            <span class="c1"># stop timer and clear status if already running</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">periodic_call_timer</span><span class="o">.</span><span class="n">isActive</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">periodic_call_timer</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">status_bar</span><span class="o">.</span><span class="n">removeWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">periodic_status</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">periodic_call_timer</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">periodic_status</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span>
                    <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> every </span><span class="si">%s</span><span class="s1"> sec&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">command</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">status_bar</span><span class="o">.</span><span class="n">addPermanentWidget</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">periodic_status</span><span class="p">)</span>

            <span class="c1"># execute commands now</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_execute_commands</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">periodic_call_timer</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">status_bar</span><span class="o">.</span><span class="n">removeWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">periodic_status</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span></div>

<div class="viewcode-block" id="DAQWidget._execute_commands"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.DAQWidget._execute_commands">[docs]</a>    <span class="k">def</span> <span class="nf">_execute_commands</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Execute periodic commands</span>

<span class="sd">        :returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">command</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">periodic_commands</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daq_put</span><span class="p">(</span><span class="n">command</span><span class="p">)</span></div>

<div class="viewcode-block" id="DAQWidget.update"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.DAQWidget.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update daq msg log</span>

<span class="sd">        :returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">daq_get_last_msg</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daq_msg_log</span><span class="o">.</span><span class="n">appendPlainText</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_file</span><span class="o">.</span><span class="n">closed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write_to_file</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>

<div class="viewcode-block" id="DAQWidget._write_to_file"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.DAQWidget._write_to_file">[docs]</a>    <span class="k">def</span> <span class="nf">_write_to_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write the &quot;RAW&quot; file</span>

<span class="sd">        :param msg: daq message</span>
<span class="sd">        :type msg: str</span>
<span class="sd">        :returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">get_setting</span><span class="p">(</span><span class="s2">&quot;write_daq_status&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># only write lines containing trigger data, discard status lines</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span> <span class="o">==</span> <span class="mi">16</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">8</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">((</span><span class="s2">&quot;Not writing line &#39;</span><span class="si">%s</span><span class="s2">&#39; to file &quot;</span> <span class="o">+</span>
                                   <span class="s2">&quot;because it does not contain &quot;</span> <span class="o">+</span>
                                   <span class="s2">&quot;trigger data&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="n">msg</span><span class="p">)</span></div>

<div class="viewcode-block" id="DAQWidget.finish"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.DAQWidget.finish">[docs]</a>    <span class="k">def</span> <span class="nf">finish</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cleanup, close and rename raw file</span>

<span class="sd">        :returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_file</span><span class="o">.</span><span class="n">closed</span><span class="p">:</span>
            <span class="n">stop_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

            <span class="c1"># add duration</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">measurement_duration</span> <span class="o">+=</span> <span class="n">stop_time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# stopped run on: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span>
                                   <span class="n">stop_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">_%H-%M-%S&quot;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># only rename if file actually exists</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_file</span><span class="o">.</span><span class="n">get_filename</span><span class="p">()):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;The raw data was written for </span><span class="si">%f</span><span class="s2"> hours&quot;</span> <span class="o">%</span>
                                 <span class="n">get_hours_from_duration</span><span class="p">(</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">measurement_duration</span><span class="p">))</span>
                <span class="n">rename_muonic_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measurement_duration</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">output_file</span><span class="o">.</span><span class="n">get_filename</span><span class="p">())</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">IOError</span><span class="p">):</span>
                <span class="k">pass</span></div></div>


<div class="viewcode-block" id="GPSWidget"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.GPSWidget">[docs]</a><span class="k">class</span> <span class="nc">GPSWidget</span><span class="p">(</span><span class="n">BaseWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Shows GPS information</span>

<span class="sd">    :param logger: logger object</span>
<span class="sd">    :type logger: logging.Logger</span>
<span class="sd">    :param parent: parent widget</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">GPS_DUMP_LENGTH</span> <span class="o">=</span> <span class="mi">13</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">BaseWidget</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gps_dump</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_button</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Show GPS&quot;</span><span class="p">)</span>
        <span class="n">QtCore</span><span class="o">.</span><span class="n">QObject</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">refresh_button</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s2">&quot;clicked()&quot;</span><span class="p">),</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">on_refresh_clicked</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gps_status_log</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPlainTextEdit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gps_status_log</span><span class="o">.</span><span class="n">setReadOnly</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gps_status_log</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QFont</span><span class="p">(</span><span class="s2">&quot;monospace&quot;</span><span class="p">))</span>
        <span class="c1"># only 500 lines history</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gps_status_log</span><span class="o">.</span><span class="n">document</span><span class="p">()</span><span class="o">.</span><span class="n">setMaximumBlockCount</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">status_box</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Not read out&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gps_time_box</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">satellites_box</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checksum_box</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">latitude_box</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">longitude_box</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">altitude_box</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos_fix_box</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>

        <span class="c1"># add widgets to layout</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QGridLayout</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;GPS Display:&quot;</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Status: &quot;</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status_box</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;GPS time: &quot;</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gps_time_box</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;#Satellites: &quot;</span><span class="p">),</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">satellites_box</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Checksum: &quot;</span><span class="p">),</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">checksum_box</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Latitude: &quot;</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">latitude_box</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Longitude: &quot;</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">longitude_box</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Altitude: &quot;</span><span class="p">),</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">altitude_box</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;PosFix: &quot;</span><span class="p">),</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos_fix_box</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gps_status_log</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">refresh_button</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

<div class="viewcode-block" id="GPSWidget.on_refresh_clicked"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.GPSWidget.on_refresh_clicked">[docs]</a>    <span class="k">def</span> <span class="nf">on_refresh_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Display/refresh the GPS information</span>

<span class="sd">        :returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gps_dump</span> <span class="o">=</span> <span class="p">[]</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Reading GPS.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">process_incoming</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">active</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daq_put</span><span class="p">(</span><span class="s1">&#39;DG&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">process_incoming</span><span class="p">()</span></div>

<div class="viewcode-block" id="GPSWidget._extract_gps_info"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.GPSWidget._extract_gps_info">[docs]</a>    <span class="k">def</span> <span class="nf">_extract_gps_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">strip_string</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extract GPS info from &#39;line&#39; and strip away &#39;strip_string&#39;.</span>

<span class="sd">        :param line: line number of gps output</span>
<span class="sd">        :type line: int</span>
<span class="sd">        :param strip_string: string to strip away</span>
<span class="sd">        :type strip_string: str</span>
<span class="sd">        :returns: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gps_dump</span><span class="p">[</span><span class="n">line</span><span class="p">])</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">strip_string</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="GPSWidget.update"><a class="viewcode-back" href="../../../muonic.html#muonic.gui.widgets.GPSWidget.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Readout the GPS information and display it in the tab.</span>

<span class="sd">        :returns: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gps_dump</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GPS_DUMP_LENGTH</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gps_dump</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">daq_get_last_msg</span><span class="p">())</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gps_dump</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GPS_DUMP_LENGTH</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="n">gps_time</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">pos_fix</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">latitude</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">longitude</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">altitude</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">satellites</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;Invalid&quot;</span>
        <span class="n">checksum</span> <span class="o">=</span> <span class="s2">&quot;Error&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_gps_info</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;Status:&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;A (valid)&quot;</span><span class="p">:</span>
                <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;Valid&quot;</span>
                <span class="n">gps_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_gps_info</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Date+Time:&quot;</span><span class="p">)</span>
                <span class="n">pos_fix</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_extract_gps_info</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;PosFix#:&quot;</span><span class="p">))</span>
                <span class="n">latitude</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_gps_info</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;Latitude:&quot;</span><span class="p">)</span>
                <span class="n">longitude</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_gps_info</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="s2">&quot;Longitude:&quot;</span><span class="p">)</span>
                <span class="n">altitude</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_gps_info</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="s2">&quot;Altitude:&quot;</span><span class="p">)</span>
                <span class="n">satellites</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_extract_gps_info</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;Stats used:&quot;</span><span class="p">))</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_gps_info</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="s2">&quot;ChkSumErr:&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span><span class="p">:</span>
                    <span class="n">checksum</span> <span class="o">=</span> <span class="s2">&quot;No Error&quot;</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Valid GPS signal: found </span><span class="si">%d</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="n">satellites</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Invalid GPS signal.&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">gps_dump</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Error evaluating GPS information.&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gps_dump</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gps_time_box</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">gps_time</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos_fix_box</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">pos_fix</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">latitude_box</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">latitude</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">longitude_box</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">longitude</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">altitude_box</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">altitude</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">satellites_box</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">satellites</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_box</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checksum_box</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">checksum</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gps_status_log</span><span class="o">.</span><span class="n">appendPlainText</span><span class="p">(</span><span class="s1">&#39;******************************&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gps_status_log</span><span class="o">.</span><span class="n">appendPlainText</span><span class="p">(</span><span class="s1">&#39;STATUS     : </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">status</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gps_status_log</span><span class="o">.</span><span class="n">appendPlainText</span><span class="p">(</span><span class="s1">&#39;TIME       : </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">gps_time</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gps_status_log</span><span class="o">.</span><span class="n">appendPlainText</span><span class="p">(</span><span class="s1">&#39;Altitude   : </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">altitude</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gps_status_log</span><span class="o">.</span><span class="n">appendPlainText</span><span class="p">(</span><span class="s1">&#39;Latitude   : </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">latitude</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gps_status_log</span><span class="o">.</span><span class="n">appendPlainText</span><span class="p">(</span><span class="s1">&#39;Longitude  : </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">longitude</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gps_status_log</span><span class="o">.</span><span class="n">appendPlainText</span><span class="p">(</span><span class="s1">&#39;Satellites : </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">satellites</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gps_status_log</span><span class="o">.</span><span class="n">appendPlainText</span><span class="p">(</span><span class="s1">&#39;Checksum   : </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">checksum</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gps_status_log</span><span class="o">.</span><span class="n">appendPlainText</span><span class="p">(</span><span class="s1">&#39;******************************&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">active</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">True</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">muonic 2.1.0 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2012, robert.franke,achim.stoessl,basho.kaminsky.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.6.
    </div>
  </body>
</html>